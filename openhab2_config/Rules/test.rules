/* Test */
import org.openhab.model.script.actions.Timer
var Timer timer = null 

rule "Iluminação exterior automatica (XiaomiMiSmartHomeGateway_Illumination) change/update"
when
    Item XiaomiMiSmartHomeGateway_Illumination changed
then
    if (XiaomiMiSmartHomeGateway_Illumination.state < 540){
        Sonoff7484_Switch.sendCommand(ON)
        logInfo("Sonoff1", "turn on on lux < 546")
        timer = createTimer(now.plusSeconds(5))[|
        Sonoff7484_Switch.sendCommand(OFF)
        timer = null   // reset the timer
        ])
    }
end

rule "Iluminação exterior automatica entrada carro"
when
    Item info_exterior_jardim_portao changed from CLOSED
then
    if (XiaomiMiSmartHomeGateway_Illumination.state < 420){
        light_exterior_jardim_garagem.sendCommand(ON)
        logInfo("Iluminação entrada (GR)_ON", "Iluminação exterior automatica entrada carro")
        timer = createTimer(now.plusSeconds(10))[|
        light_exterior_jardim_garagem.sendCommand(OFF)
        logInfo("Iluminação entrada (GR)_OFF", "Iluminação exterior automatica entrada carro")
        timer = null   // reset the timer
        ])
    }
end
